<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
        content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <script src="../js/area.js"></script>
    <script src="../js/selectMore.js"></script>
    <script src="../js/upload.js"></script>
    <script src="../url/url.js"></script>
    <script src="../lib/jquery/jquery.cookie.js"></script>
    <script src="../js/interceptor.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <div class="x-body">
        <form method="post" class="layui-form">
            <div class="layui-form-item">
                <label for="L_username" class="layui-form-label">
                    <span class="x-red">*</span>学号
                </label>
                <div class="layui-input-inline">
                    <input type="text" id="L_username" name="stu_id" required="" lay-verify="nikename"
                        autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label for="L_username" class="layui-form-label">
                    <span class="x-red">*</span>姓名
                </label>
                <div class="layui-input-inline">
                    <input type="text" id="L_username" name="stu_name" required="" lay-verify="nikename"
                        autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label for="L_username" class="layui-form-label">
                    <span class="x-red">*</span>性别
                </label>
                <div class="layui-input-inline">
                    <input type="radio" value="男" name="stu_sex" title="男" id="L_username" required=""
                        lay-verify="nikename" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-input-inline">
                    <input type="radio" value="女" name="stu_sex" title="女" id="L_username" required=""
                        lay-verify="nikename" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">籍贯</label>
                <div class="layui-inline">
                    <select name="province" class="province" lay-verify="required" lay-search lay-filter="province">
                        <option value="">省份</option>
                    </select>
                </div>
                <div class="layui-inline">
                    <select name="city" class="city" lay-verify="required" lay-search lay-filter="city">
                        <option value="">地级市</option>
                    </select>
                </div>
                <div class="layui-inline">
                    <select name="district" class="district" lay-verify="required" lay-search>
                        <option value="">县/区</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label for="L_pass" class="layui-form-label">
                    <span class="x-red">*</span>出生日期
                </label>
                <div class="layui-input-inline">
                    <input type="date" id="L_pass" name="stu_date" required="" lay-verify="pass" autocomplete="off"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label for="L_username" class="layui-form-label">
                    <span class="x-red">*</span>男或女朋友
                </label>
                <div class="layui-input-inline">
                    <input type="text" id="L_username" name="stu_gbf" required="" lay-verify="nikename"
                        autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label for="L_username" class="layui-form-label">
                    <span class="x-red">*</span>爱好
                </label>
                <div class="layui-input-inline">
                    <input type="text" style="width:250px;height:100px;" id="L_username" name="stu_hobby" required=""
                        lay-verify="nikename" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="overdiv1Right">
                <label for="L_pass" class="layui-form-label">
                    <span class="x-red">*</span>上传头像
                </label>

                <button id="btn111" class="layui-btn">上传图片</button>
                <input type="file" class="file_inp" hidden>
                <div id="box" style="margin-left: 100px;">
                </div>
            </div>
    </div>

    <div class="layui-form-item">
        <label for="L_repass" class="layui-form-label">
        </label>
        <input type="submit" value="添加" class="layui-btn">
    </div>
    </form>
    </div>
    <script>
        layui.use(['form', 'layer'], function () {
            $ = layui.jquery;
            var form = layui.form
                , layer = layui.layer;
            //监听提交
            form.on('submit(add)', function (data) {
                console.log(data);
                //发异步，把数据提交给php
                layer.alert("增加成功", { icon: 6 }, function () {
                    // 获得frame索引
                    var index = parent.layer.getFrameIndex(window.name);
                    //关闭当前frame
                    parent.layer.close(index);
                    parent.paren
                });
                return false;
            });


        });


        $(".file_inp").change(function () {
            var file = this.files[0];
            var reader = new FileReader();

            // 将图片转换为base64字符串
            reader.readAsDataURL(file);
            reader.onload = function () {
                img_url = reader.result;
                // 创建
                var img = new Image();
                img.src = img_url;
                box.appendChild(img);
            }
        })
        $(function () {
            interceptor();
        })
        $("#btn111").click(function (e) {
            e.preventDefault();
            $(".file_inp").click();
        })

        $("input[type='submit']").click(function (e) {
            e.preventDefault();
            $.ajax({
                url: baseUrl + '/student_info',
                method: 'post',
                data: {
                    stu_id: $("input[name='stu_id']").val(),
                    stu_name: $("input[name='stu_name']").val(),
                    stu_sex: $('input:radio[name="stu_sex"]:checked').val(),
                    stu_jg: $stu_jg,
                    stu_hobby: $('input[name="stu_hobby"]').val(),
                    stu_gbf: $('input[name="stu_gbf"]').val(),
                    stu_date: $('input[name="stu_date"]').val(),
                    // stu_head_img:转换后的base64字符串
                    stu_head_img: img_url
                    // utc2beijing($("input[name='stu_date']").val())
                },
                success: function (data) {


                    layer.alert("增加成功", { icon: 6 }, function () {
                        console.log(data);
                        // 获得frame索引
                        var index = parent.layer.getFrameIndex(window.name);
                        //关闭当前frame
                        parent.layer.close(index);
                        localStorage.setItem('flag', '11')

                        // localStorage flag 1
                        // window.location = './index.html';
                    });

                },
                error: function (err) {
                    console.log(err);
                }
            })


        })
    </script>

</body>

</html>